{
  "info": {
    "name": "Sniper Order Execution Engine",
    "description": "API collection for testing the sniper order execution engine with WebSocket-based order submission",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "WebSocket - Submit Order & Stream Updates",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "ws://localhost:3000/api/orders/execute",
          "protocol": "ws",
          "host": ["localhost"],
          "port": "3000",
          "path": ["api", "orders", "execute"]
        },
        "description": "PRIMARY ENDPOINT: WebSocket connection for submitting orders and receiving real-time updates.\n\nHOW TO USE IN POSTMAN:\n1. Create a new 'WebSocket Request' in Postman\n2. Connect to: ws://localhost:3000/api/orders/execute\n3. Once connected, send this JSON message:\n\n{\n  \"tokenAddress\": \"B2DdhSFkydrDMbeamxnVyxiZNABVPoTFJjZKzSc1G3DP\",\n  \"amountIn\": \"100000000\",\n  \"slippage\": \"0.01\"\n}\n\n4. You'll receive ALL status updates in real-time:\n   - pending: Order queued\n   - monitoring: Checking for pools\n   - triggered: Pool detected\n   - routing: Comparing Raydium vs Meteora (with full quotes)\n   - building: Building transaction\n   - submitted: Transaction sent to blockchain\n   - confirmed: Success with txHash and Explorer link\n   - OR failed: Error details\n\nNO MISSED UPDATES - all status changes stream on the same connection!"
      },
      "response": []
    },
    {
      "name": "HTTP POST - Submit Order (NOT SUPPORTED)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Returns 400 error', function() {",
              "    pm.response.to.have.status(400);",
              "});",
              "",
              "const response = pm.response.json();",
              "pm.test('Asks for WebSocket connection', function() {",
              "    pm.expect(response.error).to.equal('WebSocket connection required');",
              "});",
              "",
              "console.log('Error message:', response.message);"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"tokenAddress\": \"B2DdhSFkydrDMbeamxnVyxiZNABVPoTFJjZKzSc1G3DP\",\n  \"amountIn\": \"100000000\",\n  \"slippage\": \"0.01\"\n}"
        },
        "url": {
          "raw": "http://localhost:3000/api/orders/execute",
          "protocol": "http",
          "host": ["localhost"],
          "port": "3000",
          "path": ["api", "orders", "execute"]
        },
        "description": "This endpoint returns an error. Orders must be submitted via WebSocket to receive live updates.\n\nThis test verifies that the API correctly rejects HTTP POST requests."
      },
      "response": []
    },
    {
      "name": "Get Order Status",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "const response = pm.response.json();",
              "",
              "pm.test('Status code is 200', function() {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Response has order details', function() {",
              "    pm.expect(response).to.have.property('id');",
              "    pm.expect(response).to.have.property('status');",
              "    pm.expect(response).to.have.property('token_address');",
              "});",
              "",
              "console.log('Order Status:', response.status);",
              "if (response.tx_hash) {",
              "    console.log('Transaction Hash:', response.tx_hash);",
              "    console.log('Explorer:', 'https://explorer.solana.com/tx/' + response.tx_hash + '?cluster=devnet');",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "http://localhost:3000/api/orders/{{orderId}}",
          "protocol": "http",
          "host": ["localhost"],
          "port": "3000",
          "path": ["api", "orders", "{{orderId}}"]
        },
        "description": "Get the current status of an order by orderId.\n\nUseful for checking order status after WebSocket disconnection.\n\nReplace {{orderId}} with an actual order ID from a previous WebSocket submission."
      },
      "response": []
    },
    {
      "name": "Health Check",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "const response = pm.response.json();",
              "",
              "pm.test('Status code is 200', function() {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Service is healthy', function() {",
              "    pm.expect(response.status).to.equal('healthy');",
              "});",
              "",
              "pm.test('All services connected', function() {",
              "    pm.expect(response.services.postgres).to.equal('connected');",
              "    pm.expect(response.services.redis).to.equal('connected');",
              "    pm.expect(response.services.queue).to.equal('running');",
              "});",
              "",
              "console.log('Health Status:', response.status);",
              "console.log('Services:', JSON.stringify(response.services, null, 2));"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "http://localhost:3000/health",
          "protocol": "http",
          "host": ["localhost"],
          "port": "3000",
          "path": ["health"]
        },
        "description": "Check the health status of the server and all connected services (PostgreSQL, Redis, Queue)."
      },
      "response": []
    }
  ],
  "variable": [
    {
      "key": "orderId",
      "value": "",
      "type": "string",
      "description": "Order ID from WebSocket response - use for Get Order Status endpoint"
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// This collection uses WebSocket for order submission",
          "// Make sure your server is running at http://localhost:3000"
        ]
      }
    }
  ]
}
